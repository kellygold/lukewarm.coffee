<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Alloy Embedded Modal Example</title>
    <script src="https://cdn.runalloy.com/scripts/embedded.js" type="text/javascript"></script>
    <style>
      body {
        text-align: center;
      }

      .integration-option {
        display: inline-block;
        margin: 10px;
        padding: 20px;
        border: 1px solid #ccc;
        border-radius: 5px;
        cursor: pointer;
      }

      .integration-option img {
        width: 100px;
        height: auto;
        display: block;
        margin: 0 auto;
      }
    </style>
  </head>
  <body>
    <h1>Alloy Embedded Modal Example</h1>
    <h2> <%= data.token %></h2>

    <div id="integration-options">
      <!-- The integration options will be added here -->
    </div>

    <script>
      // The click event handler for integration options
      function selectIntegration(integrationId) {
        Alloy.setToken('<%= data.token %>');
        Alloy.install({
          integrationId: integrationId,
          callback: () => {
            console.log("Alloy Embedded Modal installed successfully.");
          }
        });
      }

      // Fetch the integration data and render the options
      (async function() {
        Alloy.setToken('<%= data.token %>');
        const integrations = await Alloy.getIntegrations();
        const integrationOptions = document.getElementById('integration-options');

        for (const integration of integrations.data) {
          const option = document.createElement('div');
          option.classList.add('integration-option');
          option.innerHTML = `<h3>${integration.app}</h3><img src="${integration.icon}" alt="${integration.app}">`;
          option.addEventListener('click', () => selectIntegration(integration.integrationId));
          integrationOptions.appendChild(option);
        }
      })();
    </script>
  </body>
</html>
